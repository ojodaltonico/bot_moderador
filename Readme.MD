# ğŸ¤– Bot Moderador de WhatsApp

Sistema automatizado de moderaciÃ³n para grupos de WhatsApp con gestiÃ³n de infracciones, strikes y apelaciones.

## âœ¨ CaracterÃ­sticas

- âœ… **DetecciÃ³n automÃ¡tica** de ventas y contenido inapropiado
- âš ï¸ **Sistema de strikes** (3 strikes = expulsiÃ³n)
- ğŸ“¸ **RevisiÃ³n manual** de imÃ¡genes sospechosas
- ğŸ“ **Sistema de apelaciones** para usuarios
- ğŸ›¡ï¸ **Panel de moderaciÃ³n** con comandos interactivos
- ğŸ“Š **Historial completo** de acciones y casos
- ğŸ”„ **ReconexiÃ³n automÃ¡tica** de WhatsApp

## ğŸš€ Inicio RÃ¡pido

### Requisitos
- Python 3.10+
- Node.js 18+
- 1 GB RAM mÃ­nimo

### InstalaciÃ³n Local (Windows)

1. **Clonar el repositorio**
```bash
git clone https://github.com/TU-USUARIO/bot-moderador.git
cd bot-moderador
```

2. **Configurar variables de entorno**
```bash
copy .env.example .env
notepad .env
```

Edita el archivo `.env`:
```env
GROUP_ID=TU_GROUP_ID@g.us
ADMIN_PHONE=TU_TELEFONO
```

3. **Ejecutar el bot**
```bash
start.bat
```

4. **Escanear QR** con WhatsApp (Ajustes > Dispositivos vinculados)

### InstalaciÃ³n Local (Linux/Mac)

1. **Clonar y configurar**
```bash
git clone https://github.com/TU-USUARIO/bot-moderador.git
cd bot-moderador
cp .env.example .env
nano .env
```

2. **Ejecutar**
```bash
chmod +x start.sh
./start.sh
```

## ğŸ“± Â¿CÃ³mo Cambiar de Grupo?

Solo necesitas cambiar el `GROUP_ID` en el archivo `.env`:

1. **Obtener el ID del grupo**:
   - En WhatsApp Web, abre el grupo
   - La URL serÃ¡: `https://web.whatsapp.com/send?jid=XXXXXXXXX@g.us`
   - Copia el nÃºmero completo con `@g.us`

2. **Actualizar .env**:
   ```env
   GROUP_ID=NUEVO_ID@g.us
   ```

3. **Reiniciar el bot**

## ğŸ› ï¸ Comandos

### Para Usuarios
- `strikes` - Ver tus advertencias
- `reglas` - Ver reglas del grupo
- `apelar` - Apelar una sanciÃ³n

### Para Moderadores
- `estoy` - Ver siguiente caso pendiente
- Responder con `1`, `2` o `3` segÃºn las opciones mostradas

### Para Administradores
- `agregar mod +54XXXXXXXXX` - Agregar moderador
- `quitar mod +54XXXXXXXXX` - Quitar moderador

## ğŸ“Š Mantenimiento

### Limpieza AutomÃ¡tica
```bash
python maintenance.py
```

Esto:
- Limpia imÃ¡genes antiguas (>30 dÃ­as)
- Archiva casos resueltos
- Crea backup de la base de datos
- Muestra estadÃ­sticas

### Ver Base de Datos
```bash
python check_db.py
```

## ğŸŒ Deployment en DonWeb

Ver guÃ­a completa: [DEPLOYMENT_DONWEB.md](DEPLOYMENT_DONWEB.md)

**Resumen**:
1. Contratar servidor Ubuntu (1 vCore, 1 GB RAM)
2. Instalar Python, Node.js, PM2
3. Subir proyecto y configurar `.env`
4. `pm2 start ecosystem.config.cjs`
5. Escanear QR de WhatsApp

## ğŸ”§ ConfiguraciÃ³n Avanzada

### Cambiar Cantidad de Strikes
En `.env`:
```env
MAX_STRIKES=3  # Cambiar a 2, 4, etc.
```

### Agregar Palabras Clave
En `whatsapp/index.js`, lÃ­nea 18:
```javascript
const SALES_KEYWORDS = ["vendo", "compro", "TU_PALABRA"];
```

### Cambiar RetenciÃ³n de ImÃ¡genes
En `.env`:
```env
IMAGE_RETENTION_DAYS=30  # DÃ­as antes de borrar
```

## ğŸ“ Estructura del Proyecto

```
bot-moderador/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ handlers/         # LÃ³gica de conversaciÃ³n
â”‚   â”œâ”€â”€ models/          # Modelos de base de datos
â”‚   â”œâ”€â”€ utils/           # Utilidades
â”‚   â””â”€â”€ main.py          # API FastAPI
â”œâ”€â”€ whatsapp/
â”‚   â”œâ”€â”€ index.js         # Bot de WhatsApp
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ media/               # ImÃ¡genes temporales
â”œâ”€â”€ logs/                # Archivos de log
â”œâ”€â”€ .env                 # ConfiguraciÃ³n (NO subir a Git)
â”œâ”€â”€ start.bat            # Inicio rÃ¡pido Windows
â”œâ”€â”€ start.sh             # Inicio rÃ¡pido Linux/Mac
â””â”€â”€ maintenance.py       # Script de mantenimiento
```

## ğŸ› SoluciÃ³n de Problemas

### El bot no detecta mensajes
- Verifica que `GROUP_ID` sea correcto
- Revisa que WhatsApp estÃ© conectado: `pm2 logs bot-whatsapp`

### WhatsApp se desconecta constantemente
```bash
rm -rf whatsapp/auth
pm2 restart bot-whatsapp
# Volver a escanear QR
```

### La API no responde
```bash
pm2 logs bot-api
# Verificar puerto 8000 libre
```

